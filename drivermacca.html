<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Macca Driver â€¢ Ultra Dynamic</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --bg-dark: #0a0f1c;
            --bg-darker: #060b14;
            --card-glass: rgba(20, 28, 48, 0.82);
            --accent-blue: #00d4ff;
            --accent-blue-dark: #00a0cc;
            --accent-neon: #00f0ff;
            --text-main: #f0f4f8;
            --text-muted: #94a3b8;
            --gold-start: #ffd700;
            --gold-end: #ffaa00;
            --success: #22c55e;
            --danger: #ef4444;
            --card-radius: 24px;
            --shadow-sm: 0 6px 16px rgba(0,0,0,0.35);
            --shadow-md: 0 12px 32px rgba(0,0,0,0.45);
            --transition: all 0.24s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
            background: var(--bg-darker);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            padding-bottom: 120px;
            background-image: 
                radial-gradient(circle at 15% 15%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 85% 85%, rgba(255, 170, 0, 0.06) 0%, transparent 50%);
            -webkit-font-smoothing: antialiased;
        }

        #login-screen {
            position: fixed; inset: 0;
            background: var(--bg-dark);
            display: flex; align-items: center; justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(8px);
        }

        .login-box {
            background: rgba(20, 28, 48, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 212, 255, 0.18);
            border-radius: 32px;
            padding: 2.5rem 2rem;
            width: 88%;
            max-width: 380px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            text-align: center;
        }

        .pin-field {
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(0,212,255,0.4);
            color: white;
            font-size: 3.2rem;
            font-weight: 800;
            text-align: center;
            border-radius: 20px;
            width: 100%;
            height: 90px;
            margin: 1.8rem 0;
            outline: none;
            transition: border-color 0.3s;
        }

        .pin-field:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(0,212,255,0.2);
        }

        .stats-header {
            padding: 1.2rem 1.5rem;
            background: rgba(10, 15, 28, 0.92);
            backdrop-filter: blur(16px);
            position: sticky; top: 0; z-index: 900;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        }

        .stat-badge {
            background: linear-gradient(135deg, var(--gold-start), var(--gold-end));
            color: #0f172a;
            padding: 0.5rem 1.2rem;
            border-radius: 999px;
            font-weight: 800;
            font-size: 0.95rem;
            display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 12px rgba(255,215,0,0.3);
        }

        .logout-inline {
            width: 42px; height: 42px;
            background: rgba(239,68,68,0.15);
            color: var(--danger);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(239,68,68,0.3);
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-inline:hover { background: rgba(239,68,68,0.25); transform: scale(1.08); }

        .order-card {
            background: var(--card-glass);
            border-radius: var(--card-radius);
            border: 1px solid rgba(255,255,255,0.07);
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .order-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .card-top {
            padding: 1.4rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .cust-name {
            font-weight: 800;
            font-size: 1.35rem;
            color: var(--accent-blue);
            margin: 0;
            cursor: pointer;
            transition: color 0.2s;
        }

        .cust-name:hover { color: var(--accent-neon); }

        .cust-phone {
            font-size: 0.95rem;
            color: var(--success);
            font-weight: 700;
            margin-top: 4px;
            display: block;
            cursor: pointer;
        }

        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 10px;
            padding: 1.2rem;
            background: rgba(0,0,0,0.25);
        }

        .btn-real {
            border: none;
            border-radius: 18px;
            padding: 1rem 0.6rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-weight: 800;
            font-size: 0.72rem;
            color: white;
            transition: var(--transition);
            backdrop-filter: blur(4px);
        }

        .btn-real:active { transform: scale(0.96); }

        .btn-maps    { background: rgba(66,133,244,0.18); border: 1px solid #4285f4; }
        .btn-wa      { background: rgba(37,211,102,0.18); border: 1px solid #25d366; }
        .btn-ambil   { background: linear-gradient(135deg, var(--gold-start), var(--gold-end)); color: #0f172a; font-size: 0.9rem; grid-column: span 2; }
        .btn-dapur   { background: #2d3748; color: #9ca3af; pointer-events: none; grid-column: span 2; }
        .btn-done    { background: var(--success); color: white; }
        .btn-cancel  { background: var(--danger); color: white; }
        .btn-locked  { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.4); pointer-events: none; grid-column: span 2; }

        .modern-item {
            background: rgba(255,255,255,0.04);
            border-radius: 20px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: var(--shadow-sm);
        }

        .nav-dock {
            position: fixed;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            max-width: 420px;
            background: rgba(20, 28, 48, 0.96);
            backdrop-filter: blur(24px);
            border-radius: 999px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-around;
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            z-index: 2000;
        }

        .dock-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 0.78rem;
            font-weight: 800;
            transition: var(--transition);
            flex: 1;
            padding: 8px 4px;
            border-radius: 16px;
        }

        .dock-btn.active {
            color: var(--accent-blue);
            background: rgba(0,212,255,0.12);
        }

        .dock-btn i { font-size: 1.5rem; }

        .fab-wa-diskon {
            position: fixed;
            bottom: 110px;
            right: 24px;
            z-index: 3000;
        }

        .wa-main-btn {
            width: 58px;
            height: 58px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            cursor: pointer;
            animation: pulse-wa 2.2s infinite;
        }

        @keyframes pulse-wa {
            0%, 100% { box-shadow: 0 0 0 0 rgba(37,211,102,0.6); }
            70%      { box-shadow: 0 0 0 18px rgba(37,211,102,0); }
        }

        .wa-main-btn i { color: #25d366; font-size: 32px; }

        .badge-notif {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2.5px solid white;
        }

        .label-admin {
            position: absolute;
            right: 78px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.95);
            color: #1e293b;
            padding: 8px 14px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.8rem;
            white-space: nowrap;
            box-shadow: 0 6px 16px rgba(0,0,0,0.35);
            pointer-events: none;
        }

        .motor-pulse {
            font-size: 90px;
            color: var(--gold-start);
            animation: pulse-gold 2.4s infinite;
            margin: 2rem 0;
            filter: drop-shadow(0 0 20px rgba(255,215,0,0.6));
        }

        @keyframes pulse-gold {
            0%, 100% { transform: scale(1); }
            50%      { transform: scale(1.12); }
        }

        .date-picker-custom {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            color: white;
            border-radius: 14px;
            padding: 0.9rem 1.2rem;
            width: 100%;
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: 1rem;
        }

        .d-none { display: none !important; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box animate__animated animate__fadeInUp">
        <h3 class="font-black text-white text-3xl uppercase tracking-wider mb-4">Macca Driver</h3>
        <input type="password" id="driver-pin" class="pin-field" placeholder="â€¢â€¢" maxlength="2" autocomplete="off">
        <button class="btn btn-info w-100 py-3 rounded-pill fw-bold mt-3 fs-5" onclick="handleLogin()">MASUK</button>
    </div>
</div>

<div id="main-app" class="d-none">
    <header class="stats-header d-flex justify-content-between align-items-center">
        <div>
            <h6 class="fw-800 mb-0 text-white fs-5">MACCA DELIVERY</h6>
            <p class="text-white-50 small mb-0">HUB AKTIF</p>
        </div>
        <div class="d-flex align-items-center gap-3">
            <div class="stat-badge">
                <i class="fa-solid fa-crown"></i>
                <span id="driver-name-display">-</span>
            </div>
            <div class="logout-inline" onclick="handleLogout()">
                <i class="fa-solid fa-right-from-bracket"></i>
            </div>
        </div>
    </header>

    <div class="container py-4">
        <div id="tab-delivery" class="tab-content row g-3"></div>
        <div id="tab-ranking" class="tab-content d-none py-3"></div>
        <div id="tab-history" class="tab-content d-none">
            <h5 class="fw-800 mb-3 text-info">LOG PENGANTARAN</h5>
            <input type="date" id="log-date-filter" class="date-picker-custom" onchange="renderWithData()">
            <div id="log-list-container" class="mt-2"></div>
        </div>
    </div>

    <div class="fab-wa-diskon" onclick="window.open('https://wa.me/6282191262682', '_blank')">
        <span class="label-admin">CHAT ADMIN</span>
        <div class="wa-main-btn">
            <div class="badge-notif">1</div>
            <i class="fa-brands fa-whatsapp"></i>
        </div>
    </div>

    <div class="nav-dock">
        <button class="dock-btn active" id="btn-tab-delivery" onclick="switchTab('delivery', this)">
            <i class="fa-solid fa-motorcycle"></i>ANTAR
        </button>
        <button class="dock-btn" id="btn-tab-ranking" onclick="switchTab('ranking', this)">
            <i class="fa-solid fa-trophy"></i>RANK
        </button>
        <button class="dock-btn" id="btn-tab-history" onclick="switchTab('history', this)">
            <i class="fa-solid fa-clock-rotate-left"></i>LOGS
        </button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBWz63o_JFK3Ucvb7IuXI1cNO8SXMHvsEA",
        authDomain: "kasirmaccanew.firebaseapp.com",
        databaseURL: "https://kasirmaccanew-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "kasirmaccanew"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const DRIVER_DB = { "11": "HASBI", "22": "REZKY", "33": "ASWAR", "66": "SENDY" };

    let currentDriver = "";
    let globalOrders = {};
    let lastOrderCount = 0;
    const notifAudio = new Audio('https://github.com/chuacarangki/toko_macca_kasir/raw/refs/heads/main/notif.mp3');

    window.handleLogin = () => {
        const pin = document.getElementById('driver-pin').value.trim();
        if (DRIVER_DB[pin]) {
            currentDriver = DRIVER_DB[pin];
            localStorage.setItem('macca_driver_logged_in', pin);
            document.getElementById('driver-name-display').innerText = currentDriver;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').classList.remove('d-none');
            
            notifAudio.play().then(() => {
                notifAudio.pause();
                notifAudio.currentTime = 0;
            }).catch(() => {});

            startListening();
        } else {
            Swal.fire({ icon: 'error', title: 'PIN SALAH', background: '#172035', color: '#fff' });
        }
    };

    window.handleLogout = () => {
        Swal.fire({
            title: 'Keluar?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Ya'
        }).then((r) => {
            if (r.isConfirmed) {
                localStorage.removeItem('macca_driver_logged_in');
                location.reload();
            }
        });
    };

    window.switchTab = (tabName, btn) => {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('d-none'));
        document.getElementById('tab-' + tabName).classList.remove('d-none');
        document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        window.renderWithData();
    };

    window.ambilPesanan = (id) => {
        update(ref(db, `pesanan_masuk/${id}`), {
            status: 'Diantar',
            driver_name: currentDriver
        }).then(() => {
            Swal.fire({ icon: 'success', title: 'PESANAN DIAMBIL', timer: 1000, showConfirmButton: false });
        });
    };

    window.lepasPesanan = (id) => {
        update(ref(db, `pesanan_masuk/${id}`), {
            status: 'Menunggu Driver',
            driver_name: null
        });
    };

    window.selesaiAntar = (id) => {
        const now = new Date();
        const dateStr = now.toISOString().split('T')[0];
        const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

        update(ref(db, `pesanan_masuk/${id}`), {
            status: 'Sukses',
            finish_date: dateStr,
            finish_time: timeStr
        }).then(() => {
            Swal.fire({ icon: 'success', title: 'PENGANTARAN SELESAI', timer: 1500, showConfirmButton: false });
        });
    };

    window.openWA = (num) => {
        if (!num) return;
        const cleanNum = num.replace(/[^0-9]/g, '');
        const formattedNum = cleanNum.startsWith('0') ? '62' + cleanNum.slice(1) : cleanNum;
        window.open(`https://wa.me/${formattedNum}`, '_blank');
    };

    window.directMap = (lat, lng) => {
        if (!lat || !lng) {
            Swal.fire('Lokasi tidak tersedia');
            return;
        }
        window.open(`https://www.google.com/maps?q=${lat},${lng}`, '_blank');
    };

    function haversineDistance(lat1, lon1, lat2, lon2) {
        if (!lat1 || !lon1 || !lat2 || !lon2) return 'â€”';
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2)**2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2)**2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = R * c;
        return distance < 1 ? `${(distance * 1000).toFixed(0)} m` : `${distance.toFixed(1)} km`;
    }

    let driverLocation = { lat: -6.2349, lng: 106.9925 };

    function startListening() {
        onValue(ref(db, 'pesanan_masuk'), (s) => {
            const data = s.val() || {};
            const currentWaitingOrders = Object.values(data).filter(o => o.status === 'Menunggu Driver').length;
            
            if (currentWaitingOrders > lastOrderCount) {
                notifAudio.play().catch(() => {});
            }
            lastOrderCount = currentWaitingOrders;

            globalOrders = data;
            window.renderWithData();
        });
    }

    window.renderWithData = () => {
        const activeTab = document.getElementById('tab-delivery');
        const rankTab = document.getElementById('tab-ranking');
        const logContainer = document.getElementById('log-list-container');

        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('log-date-filter');
        if (dateInput && !dateInput.value) {
            dateInput.value = today;
        }
        const selectedDate = dateInput?.value || today;

        activeTab.innerHTML = '';
        rankTab.innerHTML = '';
        logContainer.innerHTML = '';

        const pointsMap = { "HASBI": 0, "REZKY": 0, "ASWAR": 0, "SENDY": 0 };
        let anyOrder = false;

        Object.keys(globalOrders).forEach(id => {
            const o = globalOrders[id];
            
            if (['Diterima', 'Menunggu Driver', 'Diantar'].includes(o.status)) {
                anyOrder = true;
                const isMine = o.driver_name === currentDriver;
                const isTakenByOther = o.status === 'Diantar' && !isMine;
                const waNumber = o.telepon || o.wa || '';

                const jarak = haversineDistance(
                    driverLocation.lat, driverLocation.lng,
                    parseFloat(o.lat), parseFloat(o.lng)
                );

                let metodeBadge = '';
                if (o.metode_bayar === 'COD') metodeBadge = '<span class="badge bg-success">COD</span>';
                else if (['Bank', 'Transfer'].includes(o.metode_bayar)) metodeBadge = '<span class="badge bg-primary">TRANSFER</span>';
                else if (o.metode_bayar === 'QRIS') metodeBadge = '<span class="badge bg-info">QRIS</span>';

                activeTab.innerHTML += `
                    <div class="col-12 animate__animated animate__fadeInUp">
                        <div class="order-card" style="${isMine ? 'border: 2px solid #00d4ff; background: rgba(0,212,255,0.09);' : ''}">
                            <div class="card-top d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h4 class="cust-name" onclick="openWA('${waNumber}')">${(o.pelanggan || o.name || 'PELANGGAN').toUpperCase()}</h4>
                                    <span class="cust-phone" onclick="openWA('${waNumber}')"><i class="fa-brands fa-whatsapp me-1"></i>${waNumber}</span>
                                    <p class="small text-white-50 mb-1 mt-2"><i class="fa-solid fa-location-arrow me-1"></i>${o.alamat || 'Alamat Manual'}</p>
                                    <p class="small text-warning fw-bold mb-0"><i class="fa-solid fa-route me-1"></i>Jarak: ${jarak}</p>
                                </div>
                                <div class="text-end">
                                    <div class="fw-800 text-info fs-5">Rp ${o.total_bayar?.toLocaleString('id-ID')}</div>
                                    <div class="mt-1">${metodeBadge}</div>
                                    <span class="badge ${isMine ? 'bg-info text-dark' : 'bg-secondary'} mt-1">${o.status === 'Diantar' ? 'PROSES' : o.waktu || 'BARU'}</span>
                                </div>
                            </div>

                            <div class="action-grid">
                                <button class="btn-real btn-maps" onclick="directMap('${o.lat}','${o.lng}')">
                                    <i class="fa-brands fa-google"></i>MAPS
                                </button>
                                ${o.status === 'Diterima' ? 
                                    `<button class="btn-real btn-dapur"><i class="fa-solid fa-fire-burner"></i>PROSES DAPUR</button>` :
                                    (isTakenByOther ? 
                                        `<button class="btn-real btn-locked"><i class="fa-solid fa-lock"></i>DIANTAR ${o.driver_name}</button>` : 
                                        (!isMine ? 
                                            `<button class="btn-real btn-ambil" onclick="ambilPesanan('${id}')"><i class="fa-solid fa-motorcycle"></i>AMBIL</button>` : 
                                            `<button class="btn-real btn-cancel" onclick="lepasPesanan('${id}')"><i class="fa-solid fa-xmark"></i>LEPAS</button>
                                             <button class="btn-real btn-done" onclick="selesaiAntar('${id}')"><i class="fa-solid fa-check-double"></i>SELESAI</button>`
                                        )
                                    )
                                }
                            </div>
                        </div>
                    </div>`;
            }

            if (o.status === 'Sukses' && o.driver_name && pointsMap[o.driver_name] !== undefined) {
                pointsMap[o.driver_name] += 500;
            }
        });

        if (!anyOrder) {
            activeTab.innerHTML = '<div class="text-center p-5 opacity-50"><i class="fa-solid fa-motorcycle motor-pulse"></i><p class="mt-3">Belum ada orderan masuk...</p></div>';
        }

        // TAB RANKING
        rankTab.innerHTML = '<h5 class="fw-800 mb-4 text-info">DRIVER RANKING</h5>';
        Object.keys(pointsMap).sort((a,b) => pointsMap[b] - pointsMap[a]).forEach((name, i) => {
            const medal = i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‰' : i + 1;
            rankTab.innerHTML += `<div class="modern-item d-flex align-items-center p-3"><div class="fw-800 me-3 fs-4">${medal}</div><div class="flex-grow-1 fw-bold">${name}</div><div class="fw-800 text-warning">${pointsMap[name]} pts</div></div>`;
        });

        // TAB LOGS (tetap menampilkan daftar menu di log, karena ini riwayat)
        const filteredLogs = Object.entries(globalOrders)
            .filter(([_, o]) => o.status === 'Sukses' && o.finish_date === selectedDate)
            .sort((a,b) => (b[1].finish_time || '').localeCompare(a[1].finish_time || ''));

        if (filteredLogs.length === 0) {
            logContainer.innerHTML = '<div class="text-center p-5 opacity-40"><i class="fa-solid fa-inbox fs-1 mb-3"></i><p>Tidak ada pengantaran selesai pada tanggal ini.</p></div>';
        } else {
            filteredLogs.forEach(([id, o]) => {
                let menuSummary = '';
                if (o.items?.length) {
                    menuSummary = o.items.map(item => {
                        const nama = item.n || item.name || item.nama || 'Menu';
                        const qty = item.qty || 1;
                        return `${qty}Ã— ${nama}`;
                    }).join(', ');
                }

                logContainer.innerHTML += `
                    <div class="order-card modern-item mb-3" style="border-left: 5px solid var(--success);">
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-start gap-3">
                                <div style="flex: 1;">
                                    <h6 class="fw-bold mb-2 fs-6">${o.pelanggan || 'PELANGGAN'}</h6>
                                    <div class="small text-white-50">${menuSummary || 'Tidak ada detail menu'}</div>
                                </div>
                                <div class="text-end" style="min-width: 140px;">
                                    <div class="fw-bold text-info fs-5">Rp ${o.total_bayar?.toLocaleString('id-ID')}</div>
                                    <div class="small mt-2">
                                        <strong>${o.driver_name || '?'}</strong><br>
                                        <span class="badge bg-success mt-1">SUKSES</span>
                                    </div>
                                    <div class="text-white-50 mt-2" style="font-size:0.8rem">${o.finish_time || ''}</div>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
        }
    };

    const savedPin = localStorage.getItem('macca_driver_logged_in');
    if (savedPin && DRIVER_DB[savedPin]) {
        currentDriver = DRIVER_DB[savedPin];
        document.getElementById('driver-name-display').innerText = currentDriver;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').classList.remove('d-none');
        startListening();
    }
</script>
</body>
</html>
